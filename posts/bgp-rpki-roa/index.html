<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DN42 Part 3: BGP ROA/RPKI Filtering using Docker | Usman</title>
<meta name="keywords" content="" />
<meta name="description" content="What is ROA/RPKI? Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.
Resource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.
 How does ROA/RPKI work?   Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise.">
<meta name="author" content="Usman">
<link rel="canonical" href="https://blog.usman.network/posts/bgp-rpki-roa/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.5a00d27b9099d0e99da2f0a091cdc62b9d27d50a94a4afe94f3cc721fe59d84e.css" integrity="sha256-WgDSe5CZ0OmdovCgkc3GK50n1QqUpK/pTzzHIf5Z2E4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.usman.network/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.usman.network/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.usman.network/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.usman.network/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.usman.network/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KWB2M6CZK2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-KWB2M6CZK2', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="DN42 Part 3: BGP ROA/RPKI Filtering using Docker" />
<meta property="og:description" content="What is ROA/RPKI? Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.
Resource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.
 How does ROA/RPKI work?   Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.usman.network/posts/bgp-rpki-roa/" />
<meta property="og:image" content="https://blog.usman.network/images/rpki-roa/roa-rpki-cisco.PNG" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-19T21:37:00&#43;01:00" />
<meta property="article:modified_time" content="2022-07-19T21:37:00&#43;01:00" /><meta property="og:site_name" content="Usman" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://blog.usman.network/images/rpki-roa/roa-rpki-cisco.PNG" />
<meta name="twitter:title" content="DN42 Part 3: BGP ROA/RPKI Filtering using Docker"/>
<meta name="twitter:description" content="What is ROA/RPKI? Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.
Resource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.
 How does ROA/RPKI work?   Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.usman.network/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "DN42 Part 3: BGP ROA/RPKI Filtering using Docker",
      "item": "https://blog.usman.network/posts/bgp-rpki-roa/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DN42 Part 3: BGP ROA/RPKI Filtering using Docker",
  "name": "DN42 Part 3: BGP ROA\/RPKI Filtering using Docker",
  "description": "What is ROA/RPKI? Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.\nResource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.\n How does ROA/RPKI work?   Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise.",
  "keywords": [
    
  ],
  "articleBody": "What is ROA/RPKI? Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.\nResource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.\n How does ROA/RPKI work?   Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise. On the public internet, these databases are usually hosted by Regional Internet Regestries, such as ARIN, APNIC, and RIPE.\n  Validators receive cryprograhically-signed ROAs from the Regional Internet Registries, which contains a list of all ASes and the IP prefixes that they are allows to advertise.\n  Routers query the validators with recieved BGP advertisements, to ensure that prefixe advertisements are only accepted from ASes that own them.\n   Why ROA/RPKI? ROA/RPKI can be used to prevent:\n  BGP hijacking - where an actor is able to advertise a prefix that they don’t own, with malicious intent. For example, the 2018 BGP hijack of Amazon DNS to steal crypto currency. 1\n  Route Leaks - where an AS inadvertently advertises a prefix that they don’t own. For example, in 2008, where an ISP in Pakistan accidentally announced IP routes for YouTube by blackholing the video service internally to their network. 2\n   ROA/RPKI for DN42 Similar to the public internet, ROA/RPKI has the same components on DN42:\n A central database of ASes and the IP prefixes they are allowed to advertise A validator which recieves cryptographically-signed ROAs from the central database. A BGP router that queries the validator.   1. A central database of ROAs In DN42, the central authority that maintains the ROA/RPKI database is “Burble”. Shown below, there is just .json file that contains all the data. This is what the validator will download.  2. The Validator - cloudflare/goRTR Docker Container   The validator is a cloudflare/goRTR docker container that runs on an Ununtu Linux Server, within my network.\n  It is responsible for downloading the ROA/RPKI database from Burble, and then responding to queries from my router.\n  Starting up the Docker Container The docker run command that I used to start the goRTR container:\ndocker run -ti -p 8082:8082 cloudflare/gortr -cache https://dn42.burble.com/roa/dn42_roa_46.json -verify=false -checktime=false -bind :8082\r Roughly translated, this means: create a continer using the cloudflare/gortr image, using burble’s .json file, and bind it to port 8082.   Verifying the ROA/RPKI database connectivity Checking the container’s logs, we can see that the contianer periodically downloads the ROA/RPKI database from Burble and checks to see if there are any changes.\n 3. RPKI on VyOS Shown below, the router that I installed RPKI on is my VyOS cloud router edge.dn42.lan, as it is the only node that BGP peerings with other DN42 members.\nRPKI Configuration Initially, I configured the connection to the validator container. This creates a cache of the RPKI DB from 10.0.10.13:8082 (the docker container endpoint).\n protocols {\rrpki {\rcache GoRTR {\raddress 10.0.10.13\rport 8082\r}\r}\r I also created a route map that denies prefixes, that match any RPKI “invalid” prefixes. This means that any prefixes that are not in the RPKI database, or are invalid will be filtered out of the BGP route table.\n policy {\rroute-map DN42-ROA {\rdescription DN42RouteMap\rrule 50 {\raction deny\rmatch {\rrpki invalid\r}\r}\r}\r}\r Finally, assigning the route map to BGP peers. Below is an example of a BGP peering, on the edge.dn42.lan router, with the route map applied.\n protocols {\rbgp 4242421869 {\rneighbor 172.20.16.141 {\raddress-family {\ripv4-unicast {\rroute-map {\rexport DN42-ROA\rimport DN42-ROA\r}\r}\r}\rdescription chrismoos\rebgp-multihop 250\rremote-as 4242421588\r}\r All Done!\nThe Vyos router is configured to use ROA/RPKI with the route map, so invalid prefixes are filtered out of the routing table.\n  https://www.thousandeyes.com/blog/amazon-route-53-dns-and-bgp-hijack ↩︎\n https://www.wired.com/2008/02/pakistans-accid/ ↩︎\n   ",
  "wordCount" : "636",
  "inLanguage": "en",
  "image":"https://blog.usman.network/images/rpki-roa/roa-rpki-cisco.PNG","datePublished": "2022-07-19T21:37:00+01:00",
  "dateModified": "2022-07-19T21:37:00+01:00",
  "author":{
    "@type": "Person",
    "name": "Usman"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.usman.network/posts/bgp-rpki-roa/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Usman",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.usman.network/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">

            
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KWB2M6CZK2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-KWB2M6CZK2', { 'anonymize_ip': false });
}
</script>

            
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KWB2M6CZK2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


            <a href="https://blog.usman.network/" accesskey="h" title="Usman (Alt + H)">Usman</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.usman.network/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.usman.network/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://blog.usman.network/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.usman.network/">Home</a>&nbsp;»&nbsp;<a href="https://blog.usman.network/posts/">Posts</a></div>
    <h1 class="post-title">
      DN42 Part 3: BGP ROA/RPKI Filtering using Docker
    </h1>
    <div class="post-meta">19 July, 2022&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Usman
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://blog.usman.network/images/rpki-roa/roa-rpki-cisco.PNG" alt="alt">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#what-is-roarpki" aria-label="What is ROA/RPKI?">What is ROA/RPKI?</a></li>
                <li>
                    <a href="#how--does-roarpki-work" aria-label="How  does ROA/RPKI work?">How  does ROA/RPKI work?</a></li>
                <li>
                    <a href="#why-roarpki" aria-label="Why ROA/RPKI?">Why ROA/RPKI?</a></li>
                <li>
                    <a href="#roarpki-for-dn42" aria-label="ROA/RPKI for DN42">ROA/RPKI for DN42</a><ul>
                        
                <li>
                    <a href="#1-a-central-database-of-roas" aria-label="1. A central database of ROAs">1. A central database of ROAs</a></li>
                <li>
                    <a href="#2-the-validator---cloudflaregortr-docker-container" aria-label="2. The Validator - cloudflare/goRTR Docker Container">2. The Validator - cloudflare/goRTR Docker Container</a><ul>
                        
                <li>
                    <a href="#starting-up-the-docker-container" aria-label="Starting up the Docker Container">Starting up the Docker Container</a></li>
                <li>
                    <a href="#verifying-the-roarpki-database-connectivity" aria-label="Verifying the ROA/RPKI database connectivity">Verifying the ROA/RPKI database connectivity</a></li></ul>
                </li>
                <li>
                    <a href="#3-rpki-on-vyos" aria-label="3. RPKI on VyOS">3. RPKI on VyOS</a><ul>
                        
                <li>
                    <a href="#rpki-configuration" aria-label="RPKI Configuration">RPKI Configuration</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="what-is-roarpki">What is ROA/RPKI?<a hidden class="anchor" aria-hidden="true" href="#what-is-roarpki">#</a></h2>
<p>Route Origin Authentication (ROA) - is a way to verify whether an IP prefix advertised, is actually owned by the Autonomous System (AS) that advertised it.</p>
<p>Resource Public Key Infrastructure (RPKI) - is a protocol that facilitates the exchange of ROA and other related information between ASes.</p>
<hr>
<h2 id="how--does-roarpki-work">How  does ROA/RPKI work?<a hidden class="anchor" aria-hidden="true" href="#how--does-roarpki-work">#</a></h2>
<ul>
<li>
<p>Essentially, there are central databases which contain a list of all ASes and the IP prefixes that they are allowed to advertise. On the public internet, these databases are usually hosted by Regional Internet Regestries, such as ARIN, APNIC, and RIPE.</p>
</li>
<li>
<p>Validators receive cryprograhically-signed ROAs from the Regional Internet Registries, which contains a list of all ASes and the IP prefixes that they are allows to advertise.</p>
</li>
<li>
<p>Routers query the validators with recieved BGP advertisements, to ensure that prefixe advertisements are only accepted from ASes that own them.</p>
</li>
</ul>
<hr>
<h2 id="why-roarpki">Why ROA/RPKI?<a hidden class="anchor" aria-hidden="true" href="#why-roarpki">#</a></h2>
<p>ROA/RPKI can be used to prevent:</p>
<ul>
<li>
<p><strong>BGP hijacking</strong> - where an actor is able to advertise a prefix that they don&rsquo;t own, with malicious intent. For example, the 2018 BGP hijack of Amazon DNS to steal crypto currency. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
</li>
<li>
<p><strong>Route Leaks</strong> - where an AS inadvertently advertises a prefix that they don&rsquo;t own. For example, in 2008, where an ISP in Pakistan accidentally announced IP routes for YouTube by blackholing the video service internally to their network. <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
</li>
</ul>
<hr>
<h2 id="roarpki-for-dn42">ROA/RPKI for DN42<a hidden class="anchor" aria-hidden="true" href="#roarpki-for-dn42">#</a></h2>
<p>Similar to the public internet, ROA/RPKI has the same components on DN42:</p>
<ol>
<li>A central database of ASes and the IP prefixes they are allowed to advertise</li>
<li>A validator which recieves cryptographically-signed ROAs from the central database.</li>
<li>A BGP router that queries the validator.</li>
</ol>
<hr>
<h3 id="1-a-central-database-of-roas">1. A central database of ROAs<a hidden class="anchor" aria-hidden="true" href="#1-a-central-database-of-roas">#</a></h3>
<p>In DN42, the central authority that maintains the ROA/RPKI database is <a href="https://burble.dn42/">&ldquo;Burble&rdquo;</a>. Shown below, there is just .json file that contains all the data. This is what the validator will download.
<img loading="lazy" src="/images/rpki-roa/list.PNG" alt="DB"  />
</p>
<hr>
<h3 id="2-the-validator---cloudflaregortr-docker-container">2. The Validator - cloudflare/goRTR Docker Container<a hidden class="anchor" aria-hidden="true" href="#2-the-validator---cloudflaregortr-docker-container">#</a></h3>
<ul>
<li>
<p>The validator is a <a href="https://github.com/cloudflare/gortr">cloudflare/goRTR</a> docker container that runs on an Ununtu Linux Server, within my network.</p>
</li>
<li>
<p>It is responsible for downloading the ROA/RPKI database from Burble, and then responding to queries from my router.</p>
</li>
</ul>
<h4 id="starting-up-the-docker-container">Starting up the Docker Container<a hidden class="anchor" aria-hidden="true" href="#starting-up-the-docker-container">#</a></h4>
<p>The docker run command that I used to start the goRTR container:</p>
<pre tabindex="0"><code>docker run -ti -p 8082:8082 cloudflare/gortr -cache https://dn42.burble.com/roa/dn42_roa_46.json -verify=false -checktime=false -bind :8082
</code></pre><ul>
<li>Roughly translated, this means: create a continer using the cloudflare/gortr image, using burble&rsquo;s .json file, and bind it to port 8082.</li>
</ul>
<hr>
<h4 id="verifying-the-roarpki-database-connectivity">Verifying the ROA/RPKI database connectivity<a hidden class="anchor" aria-hidden="true" href="#verifying-the-roarpki-database-connectivity">#</a></h4>
<p><img loading="lazy" src="/images/rpki-roa/logs.PNG" alt="Logs"  />
</p>
<p>Checking the container&rsquo;s logs, we can see that the contianer periodically downloads the ROA/RPKI database from Burble and checks to see if there are any changes.</p>
<hr>
<h3 id="3-rpki-on-vyos">3. RPKI on VyOS<a hidden class="anchor" aria-hidden="true" href="#3-rpki-on-vyos">#</a></h3>
<p>Shown below, the router that I installed RPKI on is my VyOS cloud router <code>edge.dn42.lan</code>, as it is the only node that BGP peerings with other DN42 members.</p>
<p><img loading="lazy" src="/images/rpki-roa/routers_only.png" alt="VyOS"  />
</p>
<h4 id="rpki-configuration">RPKI Configuration<a hidden class="anchor" aria-hidden="true" href="#rpki-configuration">#</a></h4>
<p>Initially, I configured the connection to the validator container. This creates a cache of the RPKI DB from <code>10.0.10.13:8082</code> (the docker container endpoint).</p>
<pre tabindex="0"><code> protocols {
     rpki {
         cache GoRTR {
             address 10.0.10.13
             port 8082
         }
     }
</code></pre><hr>
<p>I also created a route map that denies prefixes, that match any RPKI &ldquo;invalid&rdquo; prefixes. This means that any prefixes that are not in the RPKI database, or are invalid will be filtered out of the BGP route table.</p>
<pre tabindex="0"><code> policy {
     route-map DN42-ROA {
         description DN42RouteMap

         rule 50 {
             action deny
             match {
                 rpki invalid
             }
         }
     }
 }
</code></pre><hr>
<p>Finally, assigning the route map to BGP peers. Below is an example of a BGP peering, on the <code>edge.dn42.lan</code> router, with the route map applied.</p>
<pre tabindex="0"><code> protocols {
     bgp 4242421869 {
         neighbor 172.20.16.141 {
             address-family {
                 ipv4-unicast {
                     route-map {
                         export DN42-ROA
                         import DN42-ROA
                     }
                 }
             }
             description chrismoos
             ebgp-multihop 250
             remote-as 4242421588
         }
</code></pre><hr>
<p>All Done!</p>
<p>The Vyos router is configured to use ROA/RPKI with the route map, so invalid prefixes are filtered out of the routing table.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://www.thousandeyes.com/blog/amazon-route-53-dns-and-bgp-hijack">https://www.thousandeyes.com/blog/amazon-route-53-dns-and-bgp-hijack</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://www.wired.com/2008/02/pakistans-accid/">https://www.wired.com/2008/02/pakistans-accid/</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="https://blog.usman.network/posts/usmannet/">
    <span class="title">« Prev Page</span>
    <br>
    <span>UsmanNet 2022 - An Overview of my Network</span>
  </a>
  <a class="next" href="https://blog.usman.network/posts/hurricane-electric-ipv6/">
    <span class="title">Next Page »</span>
    <br>
    <span>Hurricane Electric IPv6 Tunnel Broker On a Ubiquiti EdgeRouter</span>
  </a>
</nav>

  </footer><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {

    this.page.url = 'https:\/\/blog.usman.network\/posts\/bgp-rpki-roa\/';
    this.page.identifier = 'https:\/\/blog.usman.network\/posts\/bgp-rpki-roa\/';
    this.page.title = 'DN42 Part 3: BGP ROA\/RPKI Filtering using Docker';
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-usman-network" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://blog.usman.network/">Usman</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null  
  });
});
</script>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
