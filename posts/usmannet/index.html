<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>UsmanNet 2022 | UsmanNet</title>
<meta name="keywords" content="" />
<meta name="description" content="click to enlarge
 Intro My network has changed quite a bit recently. In this post, I&rsquo;ll explain different components of my network and how everything fits together.
 Network Infrastructure:  There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS. I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP).">
<meta name="author" content="Usman">
<link rel="canonical" href="https://blog.usman.network/posts/usmannet/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.5a00d27b9099d0e99da2f0a091cdc62b9d27d50a94a4afe94f3cc721fe59d84e.css" integrity="sha256-WgDSe5CZ0OmdovCgkc3GK50n1QqUpK/pTzzHIf5Z2E4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blog.usman.network/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.usman.network/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.usman.network/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.usman.network/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.usman.network/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KWB2M6CZK2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-KWB2M6CZK2', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="UsmanNet 2022" />
<meta property="og:description" content="click to enlarge
 Intro My network has changed quite a bit recently. In this post, I&rsquo;ll explain different components of my network and how everything fits together.
 Network Infrastructure:  There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS. I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.usman.network/posts/usmannet/" />
<meta property="og:image" content="https://blog.usman.network/images/hn/cables.PNG" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-12T20:29:16&#43;01:00" />
<meta property="article:modified_time" content="2022-04-12T20:29:16&#43;01:00" /><meta property="og:site_name" content="Usman" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://blog.usman.network/images/hn/cables.PNG" />
<meta name="twitter:title" content="UsmanNet 2022"/>
<meta name="twitter:description" content="click to enlarge
 Intro My network has changed quite a bit recently. In this post, I&rsquo;ll explain different components of my network and how everything fits together.
 Network Infrastructure:  There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS. I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP)."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.usman.network/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "UsmanNet 2022",
      "item": "https://blog.usman.network/posts/usmannet/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "UsmanNet 2022",
  "name": "UsmanNet 2022",
  "description": "click to enlarge\n Intro My network has changed quite a bit recently. In this post, I\u0026rsquo;ll explain different components of my network and how everything fits together.\n Network Infrastructure:  There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS. I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP).",
  "keywords": [
    
  ],
  "articleBody": "click to enlarge\n Intro My network has changed quite a bit recently. In this post, I’ll explain different components of my network and how everything fits together.\n Network Infrastructure:  There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS. I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP).\n AS65534 - My Home LAN   Ubiquiti Edgerouter X - erx.usman.lan\n WireGuard VPNs to erx.zahid.lan and dn42-vps.lan. eBGP peering sessions, over the VPN connections, to AS65535 and 4242421869. Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP. Router-On-A-Stick VLANs - with a VLAN trunk down to the Cisco 2960G.    Cisco 2960G - usman-cisco.lan\n Basic Layer 2 switching to normal end user hosts.    Raspberry Pi 4 8GB - pi.usman.lan\n Running as a host for Docker apps.    WD 8TB NAS - nas.usman.lan\n SMB Shares.     AS65535 - My Cousin’s LAN   Ubiquiti Edgerouter X - erx.zahid.lan\n WireGuard VPNs to erx.usman.lan and dn42.erx.lan eBGP peering sessions, over the VPN connections, to AS65535 and AS4242421869. Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP. Redistributing learned OSPF routes (SVIs from the 3560G) into BGP.    Cisco 3560G - core.zahid.lan\n SVIs for VLANs. Advertising SVIs into the OSPF area 0 domain.    Raspberry Pi 4 8GB - pi.zahid.lan\n Running as a host for Docker apps. 6TB HDD.     AS4242421869 - My DN42 Node   A Cloud VPS running VyOS as my DN42 Node. (See my other posts for more info about DN42). eBGP peering with three upstream DN42 providers, over point to point WireGuard VPNs. eBGP peering with erx.usman.lan (my home network) and erx.zahid.lan. Filtering BGP advertisements using GoRTR RPKI ROA. Filtering BGP exports using route-maps and prefix lists, such that BGP updates from AS65535 and AS65534 aren’t advertised to DN42.  Services being hosted:   On the Raspberry Pi Docker Hosts:  Plex Media Server Radarr, Sonarr, Jackett, qBittorrent. Nextcloud. Syncthing. NGINX Proxy Manager - routes a few of the mentioned services through Cloudfare’s WAF, for DDOS mitigation and public IP obfuscation.     ",
  "wordCount" : "366",
  "inLanguage": "en",
  "image":"https://blog.usman.network/images/hn/cables.PNG","datePublished": "2022-04-12T20:29:16+01:00",
  "dateModified": "2022-04-12T20:29:16+01:00",
  "author":{
    "@type": "Person",
    "name": "Usman"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.usman.network/posts/usmannet/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "UsmanNet",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.usman.network/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">

            
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KWB2M6CZK2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-KWB2M6CZK2', { 'anonymize_ip': false });
}
</script>

            
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KWB2M6CZK2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


            <a href="https://blog.usman.network/" accesskey="h" title="UsmanNet (Alt + H)">UsmanNet</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.usman.network/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.usman.network/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://blog.usman.network/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.usman.network/">Home</a>&nbsp;»&nbsp;<a href="https://blog.usman.network/posts/">Posts</a></div>
    <h1 class="post-title">
      UsmanNet 2022
    </h1>
    <div class="post-meta">12 April, 2022&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Usman
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://blog.usman.network/images/hn/cables.PNG" alt="alt">
        
</figure>
  <div class="post-content"><p><img loading="lazy" src="/images/hn/net_map.png" alt=" Diagram"  />

<em>click to enlarge</em></p>
<hr>
<h3 id="intro">Intro<a hidden class="anchor" aria-hidden="true" href="#intro">#</a></h3>
<p>My network has changed quite a bit recently.
In this post, I&rsquo;ll explain different components of my network and how everything fits together.</p>
<hr>
<h2 id="network-infrastructure">Network Infrastructure:<a hidden class="anchor" aria-hidden="true" href="#network-infrastructure">#</a></h2>
<hr>
<p>There are two sites and a cloud VPS, interconnected with Wireguard point to point VPNs, each with their own BGP AS.
I chose to use BGP as it allows me to have more control over the segregation of my networks, compared to using areas in OSPF (or other IGP).</p>
<hr>
<h3 id="as65534---my-home-lan">AS65534 - My Home LAN<a hidden class="anchor" aria-hidden="true" href="#as65534---my-home-lan">#</a></h3>
<ul>
<li>
<p>Ubiquiti Edgerouter X - <code>erx.usman.lan</code></p>
<ul>
<li>WireGuard VPNs to <code>erx.zahid.lan</code> and <code>dn42-vps.lan</code>.</li>
<li>eBGP peering sessions, over the VPN connections, to <code>AS65535</code> and <code>4242421869</code>.</li>
<li>Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP.</li>
<li><em>Router-On-A-Stick</em> VLANs - with a VLAN trunk down to the Cisco 2960G.</li>
</ul>
</li>
<li>
<p>Cisco 2960G - <code>usman-cisco.lan</code></p>
<ul>
<li>Basic Layer 2 switching to normal end user hosts.</li>
</ul>
</li>
<li>
<p>Raspberry Pi 4 8GB - <code>pi.usman.lan</code></p>
<ul>
<li>Running as a host for Docker apps.</li>
</ul>
</li>
<li>
<p>WD 8TB NAS - <code>nas.usman.lan</code></p>
<ul>
<li>SMB Shares.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="as65535---my-cousins-lan">AS65535 - My Cousin&rsquo;s LAN<a hidden class="anchor" aria-hidden="true" href="#as65535---my-cousins-lan">#</a></h3>
<ul>
<li>
<p>Ubiquiti Edgerouter X - <code>erx.zahid.lan</code></p>
<ul>
<li>WireGuard VPNs to <code>erx.usman.lan</code> and <code>dn42.erx.lan</code></li>
<li>eBGP peering sessions, over the VPN connections, to <code>AS65535</code> and <code>AS4242421869</code>.</li>
<li>Source NAT on VPN interfaces, such that any outbound traffic destined for DN42, is NATed to a DN42 IP.</li>
<li>Redistributing learned OSPF routes (SVIs from the 3560G) into BGP.</li>
</ul>
</li>
<li>
<p>Cisco 3560G - <code>core.zahid.lan</code></p>
<ul>
<li>SVIs for VLANs.</li>
<li>Advertising SVIs into the OSPF area 0 domain.</li>
</ul>
</li>
<li>
<p>Raspberry Pi 4 8GB - <code>pi.zahid.lan</code></p>
<ul>
<li>Running as a host for Docker apps.</li>
<li>6TB HDD.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="as4242421869---my-dn42-node">AS4242421869 - My DN42 Node<a hidden class="anchor" aria-hidden="true" href="#as4242421869---my-dn42-node">#</a></h3>
<hr>
<ul>
<li>A Cloud VPS running <a href="https://vyos.io/">VyOS</a> as my DN42 Node. (See my <a href="https://blog.usman.network/posts/dn42-bgp/">other posts</a> for more info about DN42).</li>
<li>eBGP peering with three upstream DN42 providers, over point to point WireGuard VPNs.</li>
<li>eBGP peering with <code>erx.usman.lan</code> (my home network) and <code>erx.zahid.lan</code>.</li>
<li>Filtering BGP advertisements using <a href="https://dn42.eu/howto/ROA-slash-RPKI">GoRTR RPKI ROA</a>.</li>
<li>Filtering BGP exports using route-maps and prefix lists, such that BGP updates from <code>AS65535</code> and <code>AS65534</code> aren&rsquo;t advertised to DN42.</li>
</ul>
<h3 id="services-being-hosted">Services being hosted:<a hidden class="anchor" aria-hidden="true" href="#services-being-hosted">#</a></h3>
<hr>
<ul>
<li>On the Raspberry Pi Docker Hosts:
<ul>
<li><a href="https://docs.linuxserver.io/images/docker-plex">Plex Media Server</a></li>
<li><a href="https://radarr.video/">Radarr</a>, <a href="https://sonarr.tv/">Sonarr</a>, <a href="https://github.com/Jackett/Jackett">Jackett</a>, <a href="https://hub.docker.com/r/linuxserver/qbittorrent">qBittorrent</a>.</li>
<li><a href="https://nextcloud.com/athome/">Nextcloud</a>.</li>
<li><a href="https://syncthing.net/">Syncthing</a>.</li>
<li><a href="https://nginxproxymanager.com/">NGINX Proxy Manager</a> - routes a few of the mentioned services through <a href="https://www.cloudflare.com/en-gb/waf/">Cloudfare&rsquo;s WAF</a>, for DDOS mitigation and public IP obfuscation.</li>
</ul>
</li>
</ul>
<hr>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="next" href="https://blog.usman.network/posts/hurricane-electric-ipv6/">
    <span class="title">Next Page »</span>
    <br>
    <span>Hurricane Electric IPv6 Tunnel Broker On a Ubiquiti EdgeRouter</span>
  </a>
</nav>

  </footer><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {

    this.page.url = 'https:\/\/blog.usman.network\/posts\/usmannet\/';
    this.page.identifier = 'https:\/\/blog.usman.network\/posts\/usmannet\/';
    this.page.title = 'UsmanNet 2022';
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-usman-network" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://blog.usman.network/">UsmanNet</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null  
  });
});
</script>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
